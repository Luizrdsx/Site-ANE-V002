<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agendamento de Aulas - ANE</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: #f5f5f5;
            min-height: 100vh;
        }

        header {
            background: #1B4D3E;
            color: white;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .btn-logout {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            cursor: pointer;
        }

        .btn-logout:hover {
            background: #c0392b;
        }

        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        h1 {
            text-align: center;
            color: #1B4D3E;
            margin-bottom: 2rem;
        }

        .agendamento-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 1.5rem;
        }

        @media (max-width: 900px) {
            .agendamento-grid {
                grid-template-columns: 1fr;
            }
        }

        .section {
            background: white;
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .section h2 {
            color: #1B4D3E;
            margin-bottom: 1rem;
            font-size: 1.1rem;
            border-bottom: 2px solid #1B4D3E;
            padding-bottom: 0.5rem;
        }

        /* PROFESSORES */
        .professores-lista {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .professor-card {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .professor-card:hover {
            border-color: #1B4D3E;
            background: #f0f8f0;
        }

        .professor-card.selecionado {
            border-color: #1B4D3E;
            background: #1B4D3E;
            color: white;
        }

        .professor-icon {
            font-size: 1.5rem;
        }

        .professor-info h4 {
            font-size: 0.95rem;
        }

        .professor-info span {
            font-size: 0.8rem;
            opacity: 0.8;
        }

        /* CALEND√ÅRIO FIXO */
        .calendario {
            width: 100%;
        }

        .calendario-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            background: #1B4D3E;
            color: white;
            padding: 0.75rem;
            border-radius: 8px;
        }

        .calendario-header button {
            background: white;
            color: #1B4D3E;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-weight: bold;
            font-size: 1rem;
        }

        .calendario-header button:hover {
            background: #e0e0e0;
        }

        .calendario-header span {
            font-weight: bold;
        }

        .dias-semana {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            text-align: center;
            margin-bottom: 0.5rem;
        }

        .dias-semana span {
            font-weight: bold;
            color: #1B4D3E;
            font-size: 0.75rem;
            padding: 0.5rem 0;
        }

        .dias-mes {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 3px;
        }

        .dia {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s;
        }

        .dia:hover:not(.desativado):not(.vazio) {
            background: #e8f5e9;
        }

        .dia.hoje {
            border: 2px solid #1B4D3E;
        }

        .dia.selecionado {
            background: #1B4D3E;
            color: white;
        }

        .dia.desativado {
            color: #ccc;
            cursor: not-allowed;
        }

        .dia.vazio {
            cursor: default;
        }

        /* HOR√ÅRIOS */
        .horarios-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.5rem;
            max-height: 400px;
            overflow-y: auto;
        }

        .horario {
            padding: 0.6rem 0.3rem;
            text-align: center;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.2s;
        }

        .horario:hover:not(.indisponivel) {
            border-color: #1B4D3E;
            background: #e8f5e9;
        }

        .horario.selecionado {
            background: #1B4D3E;
            color: white;
            border-color: #1B4D3E;
        }

        .horario.indisponivel {
            background: #f0f0f0;
            color: #aaa;
            cursor: not-allowed;
            text-decoration: line-through;
        }

        .msg-selecione {
            text-align: center;
            color: #888;
            padding: 2rem;
        }

        /* BOT√ÉO CONFIRMAR */
        .btn-confirmar {
            display: block;
            width: 100%;
            max-width: 400px;
            margin: 2rem auto;
            padding: 1rem 2rem;
            background: #1B4D3E;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-confirmar:hover {
            background: #2d7f70;
            transform: translateY(-2px);
        }

        /* TABELA AGENDAMENTOS */
        .meus-agendamentos {
            background: white;
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-top: 2rem;
        }

        .meus-agendamentos h2 {
            color: #1B4D3E;
            margin-bottom: 1rem;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        th {
            background: #1B4D3E;
            color: white;
        }

        tr:hover {
            background: #f5f5f5;
        }

        .btn-cancelar {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 0.3rem 0.6rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .btn-cancelar:hover {
            background: #c0392b;
        }

        .sem-agendamentos {
            text-align: center;
            color: #888;
            padding: 2rem;
        }

        .mensagem {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 1rem 2rem;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }

        .mensagem.sucesso {
            background: #27ae60;
        }

        .mensagem.erro {
            background: #e74c3c;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
    </style>
</head>
<body>
    <header>
        <div class="logo" style="display: flex; align-items: center; gap: 10px;">
            <img src="assets/logo.png" alt="ANE Logo" style="height: 40px;"> 
            Sistema de Agendamento
        </div>
        <div class="user-info">
            <span id="userEmail">Usu√°rio</span>
            <button class="btn-logout" onclick="logout()">Sair</button>
        </div>
    </header>

    <div class="container">
        <h1>üìÖ Agendar Aula</h1>

        <div class="agendamento-grid">
            <!-- 1. PROFESSORES -->
            <div class="section">
                <h2>1. Selecione o Professor</h2>
                <div class="professores-lista" id="listaProfessores"></div>
            </div>

            <!-- 2. CALEND√ÅRIO FIXO -->
            <div class="section">
                <h2>2. Selecione a Data</h2>
                <div class="calendario">
                    <div class="calendario-header">
                        <button onclick="mesAnterior()">&#60;</button>
                        <span id="mesAno"></span>
                        <button onclick="proximoMes()">&#62;</button>
                    </div>
                    <div class="dias-semana">
                        <span>Dom</span>
                        <span>Seg</span>
                        <span>Ter</span>
                        <span>Qua</span>
                        <span>Qui</span>
                        <span>Sex</span>
                        <span>S√°b</span>
                    </div>
                    <div class="dias-mes" id="diasMes"></div>
                </div>
            </div>

            <!-- 3. HOR√ÅRIOS -->
            <div class="section">
                <h2>3. Selecione o Hor√°rio</h2>
                <div id="horariosContainer">
                    <p class="msg-selecione">Selecione uma data para ver os hor√°rios</p>
                </div>
            </div>
        </div>

        <button class="btn-confirmar" onclick="confirmarAgendamento()">‚úÖ Confirmar Agendamento</button>

        <!-- MEUS AGENDAMENTOS -->
        <div class="meus-agendamentos">
            <h2>üìã Meus Agendamentos</h2>
            <div id="tabelaAgendamentos"></div>
        </div>
    </div>

    <script>
        // Verificar login - se n√£o estiver logado, redireciona
        const logado = localStorage.getItem('logado');
        if (logado !== 'true') {
            window.location.replace('acesso-interno.html');
        }

        // Mostrar email do usu√°rio
        const email = localStorage.getItem('userEmail') || 'Usu√°rio';
        document.getElementById('userEmail').textContent = email;

        // DADOS
        const professores = [
            { id: 1, nome: 'Julian', instrumento: 'Piano', icone: 'üéπ' },
            { id: 2, nome: 'Iago', instrumento: 'Piano', icone: 'üéπ' },
            { id: 3, nome: 'Igor', instrumento: 'Viol√£o', icone: 'üé∏' },
            { id: 4, nome: 'Isadora', instrumento: 'Piano', icone: 'üéπ' },
            { id: 5, nome: 'Leonardo', instrumento: 'Canto', icone: 'üé§' },
            { id: 6, nome: 'Guilherme', instrumento: 'Canto', icone: 'üé§' }
        ];

        let professorSelecionado = null;
        let dataSelecionada = null;
        let horarioSelecionado = null;
        let mesAtual = new Date().getMonth();
        let anoAtual = new Date().getFullYear();

        // RENDER PROFESSORES
        function renderProfessores() {
            const lista = document.getElementById('listaProfessores');
            lista.innerHTML = professores.map(p => `
                <div class="professor-card ${professorSelecionado === p.id ? 'selecionado' : ''}" onclick="selecionarProfessor(${p.id})">
                    <span class="professor-icon">${p.icone}</span>
                    <div class="professor-info">
                        <h4>${p.nome}</h4>
                        <span>${p.instrumento}</span>
                    </div>
                </div>
            `).join('');
        }

        function selecionarProfessor(id) {
            professorSelecionado = id;
            renderProfessores();
            renderHorarios();
        }

        // RENDER CALEND√ÅRIO
        function renderCalendario() {
            const meses = ['Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho', 
                          'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
            
            document.getElementById('mesAno').textContent = `${meses[mesAtual]} ${anoAtual}`;

            const primeiroDia = new Date(anoAtual, mesAtual, 1).getDay();
            const ultimoDia = new Date(anoAtual, mesAtual + 1, 0).getDate();
            const hoje = new Date();
            hoje.setHours(0, 0, 0, 0);

            let diasHTML = '';

            // Dias vazios antes do primeiro dia
            for (let i = 0; i < primeiroDia; i++) {
                diasHTML += '<div class="dia vazio"></div>';
            }

            // Dias do m√™s
            for (let dia = 1; dia <= ultimoDia; dia++) {
                const data = new Date(anoAtual, mesAtual, dia);
                data.setHours(0, 0, 0, 0);
                
                const isHoje = data.getTime() === hoje.getTime();
                const isPassado = data < hoje;
                const isSelecionado = dataSelecionada && 
                    dataSelecionada.getDate() === dia && 
                    dataSelecionada.getMonth() === mesAtual && 
                    dataSelecionada.getFullYear() === anoAtual;

                let classes = 'dia';
                if (isHoje) classes += ' hoje';
                if (isPassado) classes += ' desativado';
                if (isSelecionado) classes += ' selecionado';

                if (isPassado) {
                    diasHTML += `<div class="${classes}">${dia}</div>`;
                } else {
                    diasHTML += `<div class="${classes}" onclick="selecionarData(${dia})">${dia}</div>`;
                }
            }

            document.getElementById('diasMes').innerHTML = diasHTML;
        }

        function mesAnterior() {
            mesAtual--;
            if (mesAtual < 0) {
                mesAtual = 11;
                anoAtual--;
            }
            renderCalendario();
        }

        function proximoMes() {
            mesAtual++;
            if (mesAtual > 11) {
                mesAtual = 0;
                anoAtual++;
            }
            renderCalendario();
        }

        function selecionarData(dia) {
            dataSelecionada = new Date(anoAtual, mesAtual, dia);
            horarioSelecionado = null;
            renderCalendario();
            renderHorarios();
        }

        // RENDER HOR√ÅRIOS
        function renderHorarios() {
            const container = document.getElementById('horariosContainer');

            if (!dataSelecionada) {
                container.innerHTML = '<p class="msg-selecione">Selecione uma data para ver os hor√°rios</p>';
                return;
            }

            const horarios = gerarHorarios();
            
            if (horarios.length === 0) {
                container.innerHTML = '<p class="msg-selecione">Nenhum hor√°rio dispon√≠vel para esta data</p>';
                return;
            }

            container.innerHTML = '<div class="horarios-grid">' + horarios.map(h => `
                <div class="horario ${h.disponivel ? '' : 'indisponivel'} ${horarioSelecionado === h.hora ? 'selecionado' : ''}" 
                     onclick="${h.disponivel ? `selecionarHorario('${h.hora}')` : ''}">
                    ${h.hora}
                </div>
            `).join('') + '</div>';
        }

        function gerarHorarios() {
            const horarios = [];
            const agora = new Date();
            const isHoje = dataSelecionada.toDateString() === agora.toDateString();

            // Hor√°rios de 7:30 at√© 20:30 com intervalos de 55min (45min aula + 10min intervalo)
            let hora = 7;
            let minuto = 30;

            while (hora < 21 || (hora === 20 && minuto <= 30)) {
                const horaStr = `${hora.toString().padStart(2, '0')}:${minuto.toString().padStart(2, '0')}`;
                
                let disponivel = true;

                // Se for hoje, verificar se o hor√°rio j√° passou
                if (isHoje) {
                    const horaAtual = agora.getHours();
                    const minutoAtual = agora.getMinutes();
                    
                    if (hora < horaAtual || (hora === horaAtual && minuto <= minutoAtual)) {
                        disponivel = false;
                    }
                }

                // Verificar se j√° tem agendamento
                if (disponivel && verificarAgendamentoExistente(horaStr)) {
                    disponivel = false;
                }

                horarios.push({ hora: horaStr, disponivel });

                // Pr√≥ximo hor√°rio (55min depois)
                minuto += 55;
                if (minuto >= 60) {
                    hora += Math.floor(minuto / 60);
                    minuto = minuto % 60;
                }

                if (hora > 20 || (hora === 20 && minuto > 30)) break;
            }

            return horarios;
        }

        function verificarAgendamentoExistente(hora) {
            const agendamentos = JSON.parse(localStorage.getItem('agendamentos') || '[]');
            const dataStr = dataSelecionada.toISOString().split('T')[0];
            
            return agendamentos.some(a => 
                a.data === dataStr && 
                a.horario === hora && 
                (!professorSelecionado || a.professor_id === professorSelecionado)
            );
        }

        function selecionarHorario(hora) {
            horarioSelecionado = hora;
            renderHorarios();
        }

        // CONFIRMAR AGENDAMENTO
        function confirmarAgendamento() {
            if (!professorSelecionado) {
                mostrarMensagem('Selecione um professor!', 'erro');
                return;
            }
            if (!dataSelecionada) {
                mostrarMensagem('Selecione uma data!', 'erro');
                return;
            }
            if (!horarioSelecionado) {
                mostrarMensagem('Selecione um hor√°rio!', 'erro');
                return;
            }

            const professor = professores.find(p => p.id === professorSelecionado);
            const dataStr = dataSelecionada.toISOString().split('T')[0];

            const agendamento = {
                id: Date.now(),
                professor_id: professorSelecionado,
                professor_nome: professor.nome,
                instrumento: professor.instrumento,
                data: dataStr,
                dataFormatada: dataSelecionada.toLocaleDateString('pt-BR'),
                horario: horarioSelecionado
            };

            const agendamentos = JSON.parse(localStorage.getItem('agendamentos') || '[]');
            agendamentos.push(agendamento);
            localStorage.setItem('agendamentos', JSON.stringify(agendamentos));

            mostrarMensagem('Agendamento confirmado com sucesso!', 'sucesso');

            // Reset
            horarioSelecionado = null;
            renderHorarios();
            renderAgendamentos();
        }

        // RENDER AGENDAMENTOS
        function renderAgendamentos() {
            const container = document.getElementById('tabelaAgendamentos');
            const agendamentos = JSON.parse(localStorage.getItem('agendamentos') || '[]');

            if (agendamentos.length === 0) {
                container.innerHTML = '<p class="sem-agendamentos">Voc√™ ainda n√£o tem agendamentos</p>';
                return;
            }

            container.innerHTML = `
                <table>
                    <thead>
                        <tr>
                            <th>Professor</th>
                            <th>Instrumento</th>
                            <th>Data</th>
                            <th>Hor√°rio</th>
                            <th>A√ß√£o</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${agendamentos.map(a => `
                            <tr>
                                <td>${a.professor_nome}</td>
                                <td>${a.instrumento}</td>
                                <td>${a.dataFormatada}</td>
                                <td>${a.horario}</td>
                                <td><button class="btn-cancelar" onclick="cancelarAgendamento(${a.id})">Cancelar</button></td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        function cancelarAgendamento(id) {
            if (confirm('Tem certeza que deseja cancelar este agendamento?')) {
                let agendamentos = JSON.parse(localStorage.getItem('agendamentos') || '[]');
                agendamentos = agendamentos.filter(a => a.id !== id);
                localStorage.setItem('agendamentos', JSON.stringify(agendamentos));
                renderAgendamentos();
                renderHorarios();
                mostrarMensagem('Agendamento cancelado!', 'sucesso');
            }
        }

        function mostrarMensagem(texto, tipo) {
            const msg = document.createElement('div');
            msg.className = `mensagem ${tipo}`;
            msg.textContent = texto;
            document.body.appendChild(msg);
            setTimeout(() => msg.remove(), 3000);
        }

        function logout() {
            localStorage.removeItem('logado');
            localStorage.removeItem('userEmail');
            window.location.replace('acesso-interno.html');
        }

        // INICIAR
        renderProfessores();
        renderCalendario();
        renderAgendamentos();
    </script>
</body>
</html>
